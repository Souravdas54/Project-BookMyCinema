<style>
    /* Navbar styles */
    .navbar {
        padding: 0.5rem 1rem;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        z-index: 1030;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 56px;
    }

    /* Sidebar toggle button styles */
    #sidebarToggle {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0;
        border: 1px solid rgba(255, 255, 255, 0.3);
        transition: all 0.3s;
    }

    #sidebarToggle:hover {
        background: rgba(255, 255, 255, 0.1);
        border-color: rgba(255, 255, 255, 0.5);
        transform: scale(1.05);
    }

    #sidebarToggle i {
        font-size: 1.2rem;
    }

    .admin-image{
        width: 50px;
        height: 50px;
        border-radius: 50%;
            
    }
    /* Ensure sidebar toggle is visible on all screens */
    @media (max-width: 992px) {
        #sidebarToggle {
            display: flex !important;
        }

        .navbar-brand span.d-none.d-md-inline {
            display: inline !important;
        }

        .navbar-brand span.d-inline.d-md-none {
            display: none !important;
        }
    }

    /* For extra small screens */
    @media (max-width: 576px) {
        #sidebarToggle {
            width: 36px;
            height: 36px;
        }

        .navbar-brand span.d-none.d-md-inline {
            display: none !important;
        }

        .navbar-brand span.d-inline.d-md-none {
            display: inline !important;
        }

        .d-none.d-sm-block {
            display: none !important;
        }
    }

    /* Smooth transitions */
    .sidebar-wrapper {
        transition: transform 0.3s ease, width 0.3s ease;
    }

    /* Content wrapper adjustments */
    #content-wrapper {
        transition: margin-left 0.3s ease, width 0.3s ease;
    }

    /* Prevent horizontal scrolling */
    body {
        overflow-x: hidden;
    }
</style>
<!-- navbar.ejs -->
<nav class="navbar navbar-expand-lg navbar-dark"
    style="background: linear-gradient(135deg, var(--primary-color) 0%, #2e59d9 100%);">
    <div class="container-fluid">
        <!-- Sidebar Toggle Button - ALWAYS VISIBLE -->
        <button class="btn btn-outline-light me-2" type="button" id="sidebarToggle">
            <i class="fas fa-bars"></i>
        </button>

        <!-- Brand -->
        <a class="navbar-brand me-auto" href="/admin/dashboard">
            <i class="fas fa-film me-2"></i>
            <span class="d-none d-md-inline">BookMyCinema</span>
            <span class="d-inline d-md-none">BMC</span>
        </a>

        <!-- Responsive Spacer -->
        
        <div class="d-flex align-items-center ms-auto">
            <!-- Notifications Icon - Hidden on extra small screens -->
            <!-- <div class="d-none d-sm-block">
                <a class="nav-link position-relative" href="#" data-bs-toggle="dropdown">
                    <i class="fas fa-bell fs-5"></i>
                    <span class="badge bg-danger rounded-pill position-absolute top-0 start-100 translate-middle"
                        style="font-size: 0.6rem; padding: 0.2rem 0.4rem;">3</span>
                </a>
                <div class="dropdown-menu dropdown-menu-end p-0" style="width: 300px;">
                    <div class="p-3 border-bottom">
                        <h6 class="dropdown-header fw-bold mb-0">Notifications</h6>
                    </div>
                    <div class="list-group list-group-flush" style="max-height: 300px; overflow-y: auto;">
                        <a href="#" class="list-group-item list-group-item-action border-0">
                            <div class="d-flex align-items-center">
                                <div class="flex-shrink-0">
                                    <i class="fas fa-ticket-alt text-primary fs-5"></i>
                                </div>
                                <div class="flex-grow-1 ms-3">
                                    <p class="mb-1 fw-medium">New booking received</p>
                                    <small class="text-muted">2 minutes ago</small>
                                </div>
                            </div>
                        </a>
                        <a href="#" class="list-group-item list-group-item-action border-0">
                            <div class="d-flex align-items-center">
                                <div class="flex-shrink-0">
                                    <i class="fas fa-user-check text-success fs-5"></i>
                                </div>
                                <div class="flex-grow-1 ms-3">
                                    <p class="mb-1 fw-medium">New user registered</p>
                                    <small class="text-muted">15 minutes ago</small>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
            </div> -->

            <!-- User Dropdown -->
            <!-- <li class="nav-item dropdown list-unstyled">
                <a class="nav-link dropdown-toggle d-flex align-items-center py-2" href="#" id="userDropdown"
                    role="button" data-bs-toggle="dropdown" aria-expanded="false">
                
                    <img src="" class="admin-image" />
                </a> -->
                <!-- <div class="dropdown-menu dropdown-menu-end shadow-lg border-0" aria-labelledby="userDropdown" -->
                    <!-- style="min-width: 250px;"> -->
                    <!-- User Info Section -->
                    <!-- <div class="px-4 py-3 border-bottom">
                        
                            </p>

                            </p>
                            <span class="badge bg-primary mt-2">
                                <i class="fas fa-user-tie me-1"></i>

                            </span>
                          
                    </div> -->

                    <!-- Dropdown Links -->
                    <!-- <div class="py-2">
                        <a class="dropdown-item d-flex align-items-center py-2" href="/admin/profile">
                            <i class="fas fa-user-circle fa-fw me-3 text-primary"></i>
                            <span>My Profile</span>
                        </a>
                        <a class="dropdown-item d-flex align-items-center py-2" href="/admin/settings">
                            <i class="fas fa-cogs fa-fw me-3 text-warning"></i>
                            <span>Settings</span>
                        </a>
                        <a class="dropdown-item d-flex align-items-center py-2" href="/admin/bookings">
                            <i class="fas fa-ticket-alt fa-fw me-3 text-info"></i>
                            <span>Bookings</span>
                        </a>
                        <div class="dropdown-divider my-2"></div>
                        <a class="dropdown-item d-flex align-items-center py-2" href="#" onclick="logoutUser()">
                            <i class="fas fa-sign-out-alt fa-fw me-3 text-danger"></i>
                            <span class="fw-medium text-danger">Logout</span>
                        </a>
                    </div> -->
                <!-- </div> -->
            <!-- </li> -->
            

                 <!-- <h4 style="display: flex;">Jhon Max</h4> -->
             <!-- </div> -->
              <a class="dropdown-item d-flex align-items-center py-2" href="#" onclick="logoutUser()">
                            <i class="fas fa-sign-out-alt fa-fw me-3 text-danger"></i>
                            <span class="fw-medium text-danger">Logout</span>
                        </a>
        </div>
    </div>
</nav>

<script>
    // Sidebar Toggle Functionality - COMPLETE SOLUTION
    document.addEventListener('DOMContentLoaded', function () {
        const sidebarToggle = document.getElementById('sidebarToggle');
        const sidebarWrapper = document.getElementById('sidebar-wrapper');
        const sidebarOverlay = document.getElementById('sidebarOverlay');
        const navbarWrapper = document.getElementById('navbar-wrapper');
        const contentWrapper = document.getElementById('content-wrapper');

        // Check if sidebar wrapper exists
        if (!sidebarWrapper) {
            console.error('Sidebar wrapper not found!');
            return;
        }

        // Sidebar toggle button click handler
        if (sidebarToggle) {
            sidebarToggle.addEventListener('click', function (e) {
                e.preventDefault();
                e.stopPropagation();

                // Check screen width
                const isMobile = window.innerWidth <= 992;

                if (isMobile) {
                    // MOBILE BEHAVIOR: Show/Hide sidebar with overlay
                    const isSidebarHidden = sidebarWrapper.style.transform === 'translateX(-100%)' ||
                        !sidebarWrapper.classList.contains('show');

                    if (isSidebarHidden) {
                        // Show sidebar
                        sidebarWrapper.classList.add('show');
                        sidebarWrapper.style.transform = 'translateX(0)';

                        // Show overlay
                        if (sidebarOverlay) {
                            sidebarOverlay.classList.add('show');
                        }

                        // Prevent body scrolling
                        document.body.style.overflow = 'hidden';

                        // Update icon
                        this.querySelector('i').className = 'fas fa-times';
                    } else {
                        // Hide sidebar
                        sidebarWrapper.classList.remove('show');
                        sidebarWrapper.style.transform = 'translateX(-100%)';

                        // Hide overlay
                        if (sidebarOverlay) {
                            sidebarOverlay.classList.remove('show');
                        }

                        // Allow body scrolling
                        document.body.style.overflow = '';

                        // Update icon
                        this.querySelector('i').className = 'fas fa-bars';
                    }
                } else {
                    // DESKTOP BEHAVIOR: Collapse/Expand sidebar
                    const isCollapsed = sidebarWrapper.classList.contains('collapsed');

                    if (isCollapsed) {
                        // Expand sidebar
                        sidebarWrapper.classList.remove('collapsed');
                        if (navbarWrapper) navbarWrapper.classList.remove('expanded');
                        if (contentWrapper) contentWrapper.classList.remove('expanded');

                        // Update icon
                        this.querySelector('i').className = 'fas fa-bars';
                    } else {
                        // Collapse sidebar
                        sidebarWrapper.classList.add('collapsed');
                        if (navbarWrapper) navbarWrapper.classList.add('expanded');
                        if (contentWrapper) contentWrapper.classList.add('expanded');

                        // Update icon
                        this.querySelector('i').className = 'fas fa-times';
                    }

                    // Save state to localStorage
                    localStorage.setItem('sidebarCollapsed', !isCollapsed);
                }
            });
        }

        // Overlay click handler (mobile only)
        if (sidebarOverlay) {
            sidebarOverlay.addEventListener('click', function () {
                // Only hide on mobile
                if (window.innerWidth <= 992) {
                    sidebarWrapper.classList.remove('show');
                    sidebarWrapper.style.transform = 'translateX(-100%)';
                    this.classList.remove('show');
                    document.body.style.overflow = '';

                    // Update toggle icon
                    if (sidebarToggle) {
                        sidebarToggle.querySelector('i').className = 'fas fa-bars';
                    }
                }
            });
        }

        // Initialize sidebar on page load
        function initializeSidebar() {
            const isMobile = window.innerWidth <= 992;

            if (isMobile) {
                // MOBILE: Hide sidebar by default
                sidebarWrapper.style.transform = 'translateX(-100%)';
                sidebarWrapper.classList.remove('show');
                sidebarWrapper.classList.remove('collapsed');

                // Hide overlay
                if (sidebarOverlay) {
                    sidebarOverlay.classList.remove('show');
                }

                // Reset navbar and content
                if (navbarWrapper) navbarWrapper.style.left = '0';
                if (contentWrapper) {
                    contentWrapper.style.marginLeft = '0';
                    contentWrapper.style.width = '100%';
                }

                // Reset toggle icon
                if (sidebarToggle) {
                    sidebarToggle.querySelector('i').className = 'fas fa-bars';
                }
            } else {
                // DESKTOP: Load saved state
                const isCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';

                if (isCollapsed) {
                    sidebarWrapper.classList.add('collapsed');
                    if (navbarWrapper) navbarWrapper.classList.add('expanded');
                    if (contentWrapper) contentWrapper.classList.add('expanded');

                    // Update toggle icon
                    if (sidebarToggle) {
                        sidebarToggle.querySelector('i').className = 'fas fa-times';
                    }
                } else {
                    sidebarWrapper.classList.remove('collapsed');
                    if (navbarWrapper) navbarWrapper.classList.remove('expanded');
                    if (contentWrapper) contentWrapper.classList.remove('expanded');

                    // Update toggle icon
                    if (sidebarToggle) {
                        sidebarToggle.querySelector('i').className = 'fas fa-bars';
                    }
                }
            }
        }

        // Run initialization
        initializeSidebar();

        // Handle window resize
        let resizeTimer;
        window.addEventListener('resize', function () {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(function () {
                initializeSidebar();
            }, 250);
        });

        // Close sidebar when clicking outside (mobile only)
        document.addEventListener('click', function (event) {
            if (window.innerWidth > 992) return;

            const isClickInsideSidebar = sidebarWrapper && sidebarWrapper.contains(event.target);
            const isClickOnToggle = sidebarToggle && sidebarToggle.contains(event.target);
            const isClickOnOverlay = sidebarOverlay && sidebarOverlay.contains(event.target);

            if (!isClickInsideSidebar && !isClickOnToggle && !isClickOnOverlay &&
                sidebarWrapper && sidebarWrapper.classList.contains('show')) {

                sidebarWrapper.classList.remove('show');
                sidebarWrapper.style.transform = 'translateX(-100%)';

                if (sidebarOverlay) {
                    sidebarOverlay.classList.remove('show');
                }

                document.body.style.overflow = '';

                if (sidebarToggle) {
                    sidebarToggle.querySelector('i').className = 'fas fa-bars';
                }
            }
        });

        // Close sidebar on escape key
        document.addEventListener('keydown', function (event) {
            if (event.key === 'Escape' && window.innerWidth <= 992 &&
                sidebarWrapper && sidebarWrapper.classList.contains('show')) {

                sidebarWrapper.classList.remove('show');
                sidebarWrapper.style.transform = 'translateX(-100%)';

                if (sidebarOverlay) {
                    sidebarOverlay.classList.remove('show');
                }

                document.body.style.overflow = '';

                if (sidebarToggle) {
                    sidebarToggle.querySelector('i').className = 'fas fa-bars';
                }
            }
        });
    });

    // Logout function (keep your existing logout function)
    async function logoutUser(event) {
        if (event) {
            event.preventDefault();
            event.stopPropagation();
        }

        try {
            // Show confirmation
            if (!confirm('Are you sure you want to logout?')) {
                return;
            }

            // Call logout API
            const response = await fetch('/admin/logout', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                credentials: 'include'
            });

            const result = await response.json();

            if (result.success) {
                // Clear all cookies
                document.cookie.split(";").forEach(function (c) {
                    document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/");
                });

                // Clear localStorage and sessionStorage
                localStorage.clear();
                sessionStorage.clear();

                // Redirect to login
                window.location.href = '/admin/login';
            } else {
                alert('Logout failed: ' + result.message);
            }

        } catch (error) {
            console.error('Logout error:', error);
            alert('Error during logout. Please try again.');
            // window.location.href = '/admin/login';
            setTimeout(() => {
            window.location.href = '/admin/login';
        }, 100);
        }
    }
</script>